{% extends "nav_layout.html.jinja" %}

{% block title %}
Create Event
{% endblock %}

{% block body %}
<div class="centercontainer">
    <div class="bordered p-3">
        <div class="row">
            <div class="col-md-6">
                <form method="POST" action="/events/create">
                    <p class="headertext">Create Event</p>
                    <div class="form-group">
                        <label for="event_name">Event Name</label>
                        <input type="text" class="form-control" id="event_name" name="event_name" required>
                    </div>
                    <div class="form-group">
                        <label for="event_date">Event Date</label>
                        <input type="date" class="form-control" id="event_date" name="event_date" required>
                    </div>
                    <div class="form-group">
                        <label for="event_description">Event Description</label>
                        <textarea class="form-control" id="event_description" name="event_description" rows="3" style="resize: none;" required></textarea>
                    </div>
                    <br />
                    <button type="submit" class="btn btn-primary">Create Event</button>
                </form>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <label for="event_location">Event Location</label>
                    <input type="text" class="form-control" id="event_location" name="event_location" required>
                </div>
                <div id="map" style="height: 300px; width: 100%; margin-top: 10px;"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function initMap() {
        const geocoder = new google.maps.Geocoder();
        const map = new google.maps.Map(document.getElementById('map'), {
            zoom: 8,
            center: {lat: -34.397, lng: 150.644}
        });
        const marker = new google.maps.Marker({
            map: map
        });
        // Get user's current location
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition((position) => {
                const userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                map.setCenter(userLocation);
                marker.setPosition(userLocation);
            });
        }
        document.getElementById('event_location').addEventListener('change', () => {
            geocodeAddress(geocoder, map, marker);
        });
    }

    function geocodeAddress(geocoder, resultsMap, marker) {
        const address = document.getElementById('event_location').value;
        geocoder.geocode({'address': address}, (results, status) => {
            if (status === 'OK') {
                resultsMap.setCenter(results[0].geometry.location);
                marker.setPosition(results[0].geometry.location);
            } else {
                alert('Geocode was not successful for the following reason: ' + status);
            }
        });
    }
</script>

<script async defer
        src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMap">
</script>
{% endblock %}