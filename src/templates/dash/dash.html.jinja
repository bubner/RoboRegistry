{% extends "nav_layout.html.jinja" %}

{% block title %}
Dashboard
{% endblock %}

{% block body %}
<div class="maxtext dashheading"
    style="background: {{ 'linear-gradient(to bottom right, rgba(44, 44, 44, 0.8), rgba(255, 255, 255, 0))' if request.cookies.get('darkmode') == 'on' else 'linear-gradient(to bottom right, rgba(223, 223, 223, 0.8), rgba(255, 255, 255, 0))' }}">
    <p>Welcome aboard, {{ user.first_name.upper() }}.</p>
</div>
<br />
<div class="container" id="dashboardboxes">
    {% for i in range(3) %}
    <div class="row">
        {% for j in range(3) %}
        <div class="col-sm-4">
            <div class="square skellybones"
                style="background-color: {{ '#333' if request.cookies.get('darkmode') == 'on' else '#e9e9e9' }}; background-image: {{ 'linear-gradient(to right, #3f3f3f 0%, #616161 20%, #3f3f3f 40%, #3f3f3f 100%)' if request.cookies.get('darkmode') == 'on' else 'linear-gradient(to right, #f6f7f8 0%, #edeef1 20%, #f6f7f8 40%, #f6f7f8 100%)' }}">
            </div>
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='internal_api.js') }}"></script>
<script defer>
    api.safeFetch("/api/dashboard").then((data) => {
        // Get dashboard boxes and clear them
        const target = document.getElementById("dashboardboxes");
        target.innerHTML = "";

        // Determine if dark mode is on
        const dark = document.cookie.includes("darkmode=on");

        // Loop over data and create boxes
        let row, count = 0;
        for (const value of Object.values(data)) {
            // Add rows of 3
            if (count % 3 === 0) {
                row = document.createElement("div");
                row.classList.add("row");
                target.appendChild(row);
            }
            const box = document.createElement("div");
            box.classList.add("col-sm-4");
            const square = document.createElement("div");
            square.classList.add("square");
            square.onclick = () => {
                location.assign(value.path);
            }
            square.style.backgroundColor = dark ? "#333" : "#e9e9e9";
            square.innerHTML = `<p class="db-content">${value.text}</p>`;
            box.appendChild(square);
            row.appendChild(box);
            count++;
        }
    });
</script>
{% endblock %}